FROM openjdk:8

ENV AWS_ACCESS_KEY_ID=
ENV AWS_SECRET_ACCESS_KEY=
ENV VAULT_URI=http://dev-vault.aws.foreseeresults.com:8200
ENV VAULT_ROLE_ID=
ENV VAULT_SECRET_ID=
ENV K8S_LB=internal-dev-k8s-poc-1556943327.us-east-1.elb.amazonaws.com
ENV JAVA_OPTS="-Dspring.profiles.active=dev,aws -Deureka.environment=dev -DAPPLICATION_NAME=settings-service -DKAFKA_ADDRESS=internal-dev-kafka1-1609662500.us-east-1.elb.amazonaws.com:9092 -DKAFKA_TRACE_LOGGING_TOPIC=dev-core-platform-logging -Dcom.sun.management.jmxremote=true -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.port=10101 -Dplatform-security-redis.hostName=auth-tokens-dev.lbpwvt.ng.0001.use1.cache.amazonaws.com -Dplatform-security-redis.port=6379 -Deureka.client.eurekaServerDNSName=dev.aws.foreseeresults.com -Deureka.client.healthcheck.enabled=true -DMETRICS_TOPIC=dev-core-platform-metrics -DHYSTRIX_STREAM_TOPIC=dev-core-platform-circuit-breaker -DPLATFORM_CONFIG_SERVER_URI=http://internal-dev-platform-config-server-426440812.us-east-1.elb.amazonaws.com/platform-config-server -DHYSTRIX_STREAM_ZK_NODES=internal-dev-zookeeper1-1419869712.us-east-1.elb.amazonaws.com,internal-dev-zookeeper2-1289508936.us-east-1.elb.amazonaws.com,internal-dev-zookeeper3-403794177.us-east-1.elb.amazonaws.com -Dlogging.config=classpath:log4j2-aws.xml -Dspring.cloud.config.username=config-server-user -Dspring.cloud.config.password=secret -Deureka.instance.lease-renewal-interval-in-seconds=30 -Deureka.instance.lease-expiration-duration-in-seconds=90 -DAsyncLoggerConfig.RingBufferSize=1024 -Dspring.jpa.database-platform=org.hibernate.dialect.Oracle12cDialect"

ENV jarfile settings-service-boot.jar
ENTRYPOINT exec /usr/local/openjdk-8/bin/java $JAVA_OPTS -Deureka.instance.ipAddress=$K8S_LB -jar $jarfile

# Add the service itself
ADD settings-service-boot.jar /settings-service-boot.jar

EXPOSE 8080
